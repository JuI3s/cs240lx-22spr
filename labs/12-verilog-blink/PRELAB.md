# Prelab

In the next two labs you'll learn a bit of SystemVerilog: enough to make some
basic arithmetic and sequential circuits (lab 1), and a UART
receiver/transmitter (lab 2).

We'll be using the UPduino FPGA board and open-source tools for simulation and
synthesis.

In the first lab we'll experiment with making basic circuits. Please look
through the following resource to get started learning SystemVerilog:

* [docs/sv_guide_240lx.pdf](docs/sv_guide_240lx.pdf)

The first lab will be about applying the concepts from sections 2, 3, and 4.
The second lab will additionally involve section 5 (finite state machines) to
build a hardware UART module.

## Toolchain installation

The following open-source tools are needed for UPduino FPGA development:

* Yosys (synthesis engine)
* NextPNR (place and route tool)
* Icestorm (bitstream generation for ice40 FPGAs)
* Verilator (simulator)
* GTKWave (for displaying waveforms generated by Verilator, optional)

Installing all these tools is a bit of a pain.

**Coming soon**: some prebuilt binaries for the tools.

Scripts for building everything from source are included in the
`install-scripts` directory. 

<!-- ### Virtual machine (optional) -->
<!--  -->
<!-- If you want, you can install these tools in a virtual machine but you will -->
<!-- probably at least need the IceStorm tools to program the FPGA from outside the -->
<!-- VM (to avoid needing USB passthrough). You can use a shared folder to share the -->
<!-- bitstream file between the VM and the host. -->
<!--  -->
<!-- A Vagrantfile is provided if you want to experiment with a VM and have -->
<!-- Vagrant+VirtualBox installed. Unfortunately I haven't been able to get USB -->
<!-- passthrough to work with this setup. Run `vagrant up` and then `vagrant ssh`. -->
<!-- The `sync` directory should be shared with the lab directory on the host. -->

## Yosys

Mac:

```
brew install yosys
```

Ubuntu:

```
sudo apt install yosys
```

Build from source:

```
git clone https://github.com/YosysHQ/yosys.git yosys
cd yosys
make
sudo make install
```

## NextPNR (ice40)

```
git clone https://github.com/YosysHQ/nextpnr nextpnr-ice40
cd nextpnr-ice40
cmake -DARCH=ice40 -DCMAKE_INSTALL_PREFIX=/usr/local .
make
sudo make install
```

## Icestorm

```
git clone https://github.com/YosysHQ/icestorm.git icestorm
cd icestorm
make
sudo make install
```

## Verilator

Mac:

```
brew install verilator
```

Build from source:

```
git clone https://github.com/verilator/verilator
cd verilator
git checkout stable
autoconf
./configure
make
sudo make install
```

## GTKWave (optional)

```
sudo apt install gtkwave
```

Website: http://gtkwave.sourceforge.net/
